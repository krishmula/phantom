{
  "stack_name": "phantom-test-stack",
  "analysis_timestamp": "2026-02-20T05:15:00Z",
  "changes": [
    {
      "change_id": "DRIFT-001",
      "resource_type": "AWS::EC2::SecurityGroup",
      "resource_logical_id": "DemoSecurityGroup",
      "property_path": "SecurityGroupIngress[1]",
      "old_value": null,
      "new_value": {
        "CidrIp": "0.0.0.0/0",
        "FromPort": 110,
        "IpProtocol": "tcp",
        "ToPort": 110
      },
      "recommendation": "revert",
      "confidence": 0.95,
      "severity": "high",
      "reasoning": "Port 110 (POP3) was opened to 0.0.0.0/0 during the incident but has no correlation to the database CPU saturation issue. No logs show POP3 traffic, and the payments-service architecture does not use email retrieval protocols. This appears to be an accidental addition with no operational justification and creates an unnecessary attack surface.",
      "cost_delta_monthly_usd": 0.0,
      "refactored_value": null
    },
    {
      "change_id": "DRIFT-002",
      "resource_type": "AWS::EC2::SecurityGroup",
      "resource_logical_id": "DemoSecurityGroup",
      "property_path": "SecurityGroupIngress[2]",
      "old_value": null,
      "new_value": {
        "CidrIp": "0.0.0.0/0",
        "FromPort": 22,
        "IpProtocol": "tcp",
        "ToPort": 22
      },
      "recommendation": "refactor",
      "confidence": 0.92,
      "severity": "critical",
      "reasoning": "SSH access was opened at 02:50 UTC during incident response, and logs confirm priya.sharma established an SSH session from 73.162.45.88 at 02:52 UTC for debugging. While SSH access was operationally justified during the P1 incident, opening it to 0.0.0.0/0 is a critical security violation. The access should be restricted to the engineer's known IP address or corporate VPN CIDR range.",
      "cost_delta_monthly_usd": 0.0,
      "refactored_value": {
        "CidrIp": "73.162.45.88/32",
        "FromPort": 22,
        "IpProtocol": "tcp",
        "ToPort": 22,
        "Description": "Temporary SSH access for incident response - priya.sharma workstation"
      }
    },
    {
      "change_id": "DRIFT-003",
      "resource_type": "AWS::EC2::SecurityGroup",
      "resource_logical_id": "DemoSecurityGroup",
      "property_path": "SecurityGroupIngress[3]",
      "old_value": null,
      "new_value": {
        "CidrIp": "0.0.0.0/0",
        "FromPort": 10,
        "IpProtocol": "tcp",
        "ToPort": 10
      },
      "recommendation": "revert",
      "confidence": 0.98,
      "severity": "medium",
      "reasoning": "Port 10 is unassigned by IANA and has no standard service association. No application logs, traces, or incident timeline events reference this port. This appears to be a typo or accidental console click during the incident response when the engineer was making multiple rapid changes. There is zero operational justification for this rule.",
      "cost_delta_monthly_usd": 0.0,
      "refactored_value": null
    },
    {
      "change_id": "DRIFT-004",
      "resource_type": "AWS::EC2::SecurityGroup",
      "resource_logical_id": "DemoSecurityGroup",
      "property_path": "SecurityGroupIngress[4]",
      "old_value": null,
      "new_value": {
        "CidrIp": "0.0.0.0/0",
        "FromPort": 4001,
        "IpProtocol": "tcp",
        "ToPort": 4001
      },
      "recommendation": "revert",
      "confidence": 0.93,
      "severity": "medium",
      "reasoning": "Port 4001 is commonly used for etcd peer communication or custom application ports, but there is no evidence in the observability data that the payments-service uses this port. The incident was caused by a database query optimization issue, not a networking problem. No traces, logs, or metrics reference port 4001. This change has no documented justification and should be removed.",
      "cost_delta_monthly_usd": 0.0,
      "refactored_value": null
    }
  ],
  "aggregate_cost_delta": {
    "monthly_usd": 0.0,
    "annualized_usd": 0.0
  },
  "overall_severity": "critical",
  "executive_summary": "Four security group ingress rules were added during a P1 database incident, but only one (SSH on port 22) had operational justification. The SSH rule was opened to 0.0.0.0/0 instead of the engineer's specific IP (73.162.45.88), creating a critical security exposure. The other three rules (ports 110, 10, 4001) have no correlation to the incident root cause (a missing database index causing full table scans) and appear to be accidental additions during rapid console changes. Recommendation: revert three rules immediately, refactor SSH to restrict source IP to 73.162.45.88/32 or corporate VPN range, and address the actual root cause by adding a compound index on transactions(merchant_id, status).",
  "rectified_template": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: Hackathon demo stack for testing IaC drift reconciler \u2014 Rectified by\n  Phantom\nOutputs:\n  BucketName:\n    Description: Name of the demo S3 bucket\n    Value:\n      Ref: DemoBucket\n  SSMParameterName:\n    Description: Name of the demo SSM parameter\n    Value:\n      Ref: DemoSSMParameter\n  SecurityGroupId:\n    Description: ID of the demo security group\n    Value:\n      Ref: DemoSecurityGroup\nParameters:\n  ProjectName:\n    Default: hackathon\n    Type: String\nResources:\n  DemoBucket:\n    Properties:\n      BucketName:\n        Fn::Sub: ${ProjectName}-demo-bucket-${AWS::AccountId}\n      Tags:\n      - Key: project\n        Value:\n          Ref: ProjectName\n    Type: AWS::S3::Bucket\n  DemoSSMParameter:\n    Properties:\n      Description: Demo SSM parameter for drift testing\n      Name:\n        Fn::Sub: /${ProjectName}/demo/config\n      Tags:\n        project:\n          Ref: ProjectName\n      Type: String\n      Value: initial-value\n    Type: AWS::SSM::Parameter\n  DemoSecurityGroup:\n    Properties:\n      GroupDescription: Demo security group for drift testing\n      SecurityGroupIngress:\n      - CidrIp: 0.0.0.0/0\n        FromPort: 80\n        IpProtocol: tcp\n        ToPort: 80\n      - null\n      - CidrIp: 73.162.45.88/32\n        Description: Temporary SSH access for incident response - priya.sharma workstation\n        FromPort: 22\n        IpProtocol: tcp\n        ToPort: 22\n      Tags:\n      - Key: project\n        Value:\n          Ref: ProjectName\n    Type: AWS::EC2::SecurityGroup\n"
}